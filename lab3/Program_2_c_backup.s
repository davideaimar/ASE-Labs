.data

v1:   .double 1.1, 2.2, 3.3, 4.4, 5.5, 6.6, 7.7, 8.8, 9.9, 10.10
      .double 1.1, 2.2, 3.3, 4.4, 5.5, 6.6, 7.7, 8.8, 9.9, 10.10
      .double 1.1, 2.2, 3.3, 4.4, 5.5, 6.6, 7.7, 8.8, 9.9, 10.10
      .double 1.1, 2.2, 3.3, 4.4, 5.5, 6.6, 7.7, 8.8, 9.9, 10.10
v2:   .double 1.1, 2.2, 3.3, 4.4, 5.5, 6.6, 7.7, 8.8, 9.9, 10.10
      .double 1.1, 2.2, 3.3, 4.4, 5.5, 6.6, 7.7, 8.8, 9.9, 10.10
      .double 1.1, 2.2, 3.3, 4.4, 5.5, 6.6, 7.7, 8.8, 9.9, 10.10
      .double 1.1, 2.2, 3.3, 4.4, 5.5, 6.6, 7.7, 8.8, 9.9, 10.10
v3:   .double 1.1, 2.2, 3.3, 4.4, 5.5, 6.6, 7.7, 8.8, 9.9, 10.10
      .double 1.1, 2.2, 3.3, 4.4, 5.5, 6.6, 7.7, 8.8, 9.9, 10.10
      .double 1.1, 2.2, 3.3, 4.4, 5.5, 6.6, 7.7, 8.8, 9.9, 10.10
      .double 1.1, 2.2, 3.3, 4.4, 5.5, 6.6, 7.7, 8.8, 9.9, 10.10
v4:   .double 1.1, 2.2, 3.3, 4.4, 5.5, 6.6, 7.7, 8.8, 9.9, 10.10
      .double 1.1, 2.2, 3.3, 4.4, 5.5, 6.6, 7.7, 8.8, 9.9, 10.10
      .double 1.1, 2.2, 3.3, 4.4, 5.5, 6.6, 7.7, 8.8, 9.9, 10.10
      .double 1.1, 2.2, 3.3, 4.4, 5.5, 6.6, 7.7, 8.8, 9.9, 10.10
v5: .space 320
v6: .space 320
v7: .space 320
.code 

; PROGRAM program_2_c
; 834 RAW stalls
; 0 WAR stalls
; 42 structural stalls
; 0 branch taken stalls

main:             
    daddi r1, r0, 19 
    ;-------------------------------- 
      daddi r2, r0, 0   
      daddi r3, r0, 0 

      l.d f1, v2(r2) ; f1 = v2[i]       
      l.d f2, v3(r2) ; f2 = v3[i]
      l.d f3, v4(r2) ; f3 = v4[i]      
      l.d f0, v1(r2) ; f4 = v1[i]  
      
      mul.d f7, f1, f2 ; f7 = v2*v3
      add.d f4, f0, f7 ; f4 = v1 + v2*v3  
      mul.d f5, f4, f3 ; f5 = (v1+v2*v3)*v5        
      div.d f6, f5, f1 ;    
    ;-------------------------------- 
      daddi r4, r0, 8  
      daddi r5, r0, 8 

      l.d f9, v2(r4) ; f9 = v2[i]     
      l.d f10, v3(r4) ; f10 = v3[i]
      l.d f16, v1(r4) ; f12 = v1[i] 
      l.d f11, v4(r4) ; f11 = v4[i]      


      mul.d f15, f9, f10 ; f15 = v2*v3
      add.d f12, f16, f15 ; f12 = v1 + v2*v3   
      mul.d f13, f12, f11 ; f13 = (v1+v2*v3)*v5 
      div.d f14, f13, f9 ;    
    ;--------------------------------           

loop:
    daddi r2, r2, 16 
    l.d f1, v2(r2) ; f1 = v2[i]       
    l.d f2, v3(r2) ; f2 = v3[i]
    mul.d f7, f1, f2 ; f7 = v2*v3
    l.d f3, v4(r2) ; f3 = v4[i]      
    l.d f0, v1(r2) ; f4 = v1[i]  
    s.d f4, v5(r3)   
    add.d f4, f0, f7 ; f4 = v1 + v2*v3         
    s.d f5, v6(r3)  
    mul.d f5, f4, f3 ; f5 = (v1+v2*v3)*v5               
    s.d f6, v7(r3) 
    div.d f6, f5, f1 ; 
    daddi r3, r3, 16
    ;--------------------------------
    daddi r4, r4, 16  
    l.d f9, v2(r4)        
    l.d f10, v3(r4) 
    mul.d f15, f9, f10 
    l.d f11, v4(r4)    
    l.d f16, v1(r4) 
    s.d f12, v5(r5)   
    add.d f12, f16, f15        
    s.d f13, v6(r5)  
    mul.d f13, f12, f11               
    s.d f14, v7(r5) 
    div.d f14, f13, f9 
    daddi r1, r1, -1 
    ;--------------------------------
    
    ;--------------------------------
    bnez r1, loop 
    daddi r5, r5, 16 

    s.d f4, v5(r2)           
    s.d f5, v6(r2)                 
    s.d f6, v7(r2)

    s.d f12, v5(r4)           
    s.d f13, v6(r4)                 
    s.d f14, v7(r4)                  

    HALT